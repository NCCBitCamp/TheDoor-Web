<!DOCTYPE html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>Fix Wiring Among Us game (made for capjs)</title>
  <meta name="author" content="Lewis Nakao">
  <meta name="description" content="The Fixing Wiring mini game from Among Us written in JavaScript canvas">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="üõ∞Ô∏è Fix Wiring Among Us game">
  <meta name="twitter:description" content="The Fixing Wiring mini game from Among Us written in JavaScript canvas">
  <meta name="twitter:site" content="@lewdev">
  <meta name="twitter:creator" content="@lewdev">
  <meta name="twitter:image" content="">

  <!-- Open Graph general (Facebook, Pinterest)-->
  <meta property="og:title" content="üõ∞Ô∏è Fix Wiring Among Us game">
  <meta property="og:description" content="The Fixing Wiring mini game from Among Us written in JavaScript canvas">
  <meta property="og:url" content="https://lewdev.github.io/apps/fix-wires-js">
  <meta property="og:site_name" content="lewdev.github.io">
  <meta property="og:type" content="website">
  <meta property="og:image" content="">

  <!-- Emoji SVG favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ∞Ô∏è</text></svg>">

  <style>
    html, body {
      background: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
      margin: 0;
    }

    #canvas {
      background: white;
      max-height: 100%;
      max-width: 100%;
    }

    #sourceBtn {
      position: fixed;
      top: 0;
      right: 0;
      width: 8rem;
      background-color: #CCC;
    }
  </style>
</head>
<body>
  <div id="sourceBtn">
    <a href="https://github.com/lewdev/fix-wires-js" target="_blank" title="Source code">üë®üèª‚Äçüíª Source Code</a>
  </div>

  <canvas id="canvas" width="1920" height="1080"></canvas>
  <script>
    const context = canvas.getContext('2d');
    const W = 1920;
    const T = 1080;
    const colors = ["red", "#0F0", "#00F", "#FF0", "#F0F"];
    const letters = "     ";
    let completedMatches = [];
    let shuffledColors = [];
    let isDone = false;
    let startX, startY;
    let selectedIndex = -1;
    let lastCheckTime = 0;
    const checkInterval = 1000; // 1Ï¥à Í∞ÑÍ≤©ÏúºÎ°ú Ï≤¥ÌÅ¨

    // Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Ïû¨ÏÑ§Ï†ï
    const setBoundingRect = () => canvasRect = canvas.getBoundingClientRect();
    addEventListener("resize", setBoundingRect);
    addEventListener("scroll", setBoundingRect);
    setBoundingRect();

    // Î∞∞Ïó¥ ÏÑûÍ∏∞
    const shuffleArray = (array) => {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    };

    // ÏÑ† Í∑∏Î¶¨Í∏∞
    const drawLine = (color, x1, y1, x2, y2, lineWidth = 20) => {
      if (lineWidth === 20) drawLine("#000", x1, y1, x2, y2, 25);
      context.strokeStyle = color;
      context.beginPath();
      context.moveTo(x1, y1);
      context.lineTo(x2, y2);
      context.lineWidth = lineWidth;
      context.stroke();
    };

    // ÏÇ¨Í∞ÅÌòï Í∑∏Î¶¨Í∏∞
    const drawRect = (color, x, y, width, height) => {
      if (color !== "#000") drawRect("#000", x - 5, y - 5, width + 10, height + 10);
      context.fillStyle = color;
      context.fillRect(x, y, width, height);
    };

    // ÌÖçÏä§Ìä∏ Í∑∏Î¶¨Í∏∞
    const drawText = (text, x, y, fontSize = '1in') => {
      context.font = fontSize;
      context.fillStyle = "#000";
      context.fillText(text, x, y);
    };

    // Í≤åÏûÑ Ï¥àÍ∏∞Ìôî
    const initializeGame = () => {
      completedMatches = [];
      shuffledColors = shuffleArray([...colors]);
    };

    // ÎßàÏö∞Ïä§ Ï¢åÌëú ÏóÖÎç∞Ïù¥Ìä∏
    const updateMouseCoordinates = (clientX, clientY) => {
      const { left, top, width, height } = canvasRect;
      startX = (clientX - left) * W / width;
      startY = (clientY - top) * T / height;
    };

    // ÎßàÏö∞Ïä§ Ïù¥Îèô Ïù¥Î≤§Ìä∏
    canvas.onmousemove = (e) => updateMouseCoordinates(e.clientX, e.clientY);

    // ÎßàÏö∞Ïä§ Îã§Ïö¥ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    const handleMouseDown = () => {
      if (isDone) {
        initializeGame();
      } else if (startX < 216 && !completedMatches[selectedIndex = Math.floor(startY / 216)]) {
        selectedIndex = Math.floor(startY / 216);
      }
    };

    let alertTriggered = false; // ÌîåÎûòÍ∑∏ Ï∂îÍ∞Ä

    // ÎßàÏö∞Ïä§ ÏóÖ Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    const handleMouseUp = () => {
      if (startX > W - 216 && shuffledColors[Math.floor(startY / 216)] === colors[selectedIndex]) {
        completedMatches[selectedIndex] = 1;
        selectedIndex = -1;
      } else {
        selectedIndex = -1;
      }
    };

    let touchStartTimeout1 = null;
    let touchStartTimeout2 = null;

    // ÌÑ∞Ïπò ÏãúÏûë Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    const handleTouchStart = (e) => {
      const touch = e.changedTouches[0];
      updateMouseCoordinates(touch.clientX, touch.clientY);
      if (!touchStartTimeout1) {
        handleMouseDown();
        touchStartTimeout1 = setTimeout(() => touchStartTimeout1 = null, 300);
      }
    };

    // ÌÑ∞Ïπò Ï¢ÖÎ£å Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
    const handleTouchEnd = (e) => {
      const touch = e.changedTouches[0];
      updateMouseCoordinates(touch.clientX, touch.clientY);
      if (!touchStartTimeout2) {
        handleMouseUp();
        touchStartTimeout2 = setTimeout(() => touchStartTimeout2 = null, 300);
      }
    };

    canvas.onmousedown = handleMouseDown;
    canvas.onmouseup = handleMouseUp;
    canvas.addEventListener("touchstart", handleTouchStart);
    canvas.addEventListener("touchend", handleTouchEnd);
    canvas.addEventListener("touchmove", (e) => {
      const touch = e.changedTouches[0];
      updateMouseCoordinates(touch.clientX, touch.clientY);
    });

    // Í≤åÏûÑ ÌôîÎ©¥ Í∑∏Î¶¨Í∏∞
    const drawGame = () => {
      context.clearRect(0, 0, W, T);
      drawRect("#888", 0, 0, W, T);

      // Ïò§Î•∏Ï™Ω ÏÇ¨Í∞ÅÌòï Í∑∏Î¶¨Í∏∞
      shuffledColors.forEach((color, i) => drawRect(color, W - 216, i * 216, 216, 216));

      // ÏôºÏ™Ω ÏÇ¨Í∞ÅÌòï Î∞è ÏôÑÎ£åÎêú ÏÑ† Í∑∏Î¶¨Í∏∞
      colors.forEach((color, i) => {
        drawRect(color, 0, i * 216, 216, 216);
        if (completedMatches[i]) {
          drawLine(color, 108, i * 216 + 108, W - 108, shuffledColors.indexOf(color) * 216 + 108);
        }
        drawText(letters[i], 54, i * 216 + 108 + 20);
        drawText(letters[i], W - 162, shuffledColors.indexOf(color) * 216 + 108 + 20);
      });

      // ÌÅ¥Î¶≠Îêú ÏÑ† Í∑∏Î¶¨Í∏∞
      if (selectedIndex > -1) {
        drawLine(colors[selectedIndex], 108, selectedIndex * 216 + 108, startX, startY);
      }

      // ÏôÑÎ£å ÏÉÅÌÉú Ï≤¥ÌÅ¨ Î∞è Í≤ΩÍ≥† Î©îÏãúÏßÄ
      if (completedMatches.filter(Boolean).length === colors.length && !alertTriggered) {
          isDone = true;
          alertTriggered = true; // ÌîåÎûòÍ∑∏ ÏÑ§Ï†ï
          localStorage.setItem('elevatorRepairCompleted', 'true'); // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê ÏôÑÎ£å ÏÉÅÌÉú Ï†ÄÏû•
          alert("ÏóòÎ¶¨Î≤†Ïù¥ÌÑ∞ ÏàòÎ¶¨Î•º ÏôÑÎ£åÌñàÏäµÎãàÎã§!");
          window.location.href = '101Room.html';
      }
    };

    // Í≤åÏûÑ Î£®ÌîÑ
    const gameLoop = () => {
      requestAnimationFrame(gameLoop);
      drawGame();
    };

    initializeGame();
    gameLoop();
  </script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-GNP8ER8985"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-GNP8ER8985');
  </script>
</body>
</html>
